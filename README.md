jenkins-classloader
===================

This repo exposes the issue with the Jenkins plugin classloader that leads to fun bugs
like [12464](https://issues.jenkins-ci.org/browse/JENKINS-12464), [12124](https://issues.jenkins-ci.org/browse/JENKINS-12124)
etc.

This is the kind of stuff that makes restarting Jenkins akin to playing Russian Roulette.

Full disclosure: I haven't programmed Java in several years so my code can look like node.js. Apologies in advance.

The basic problem is a lack of synchronization in this method
[here](https://github.com/jenkinsci/jenkins/blob/ee4e9c61491e89e7879337279bc58f85eb9048d1/core/src/main/java/jenkins/ClassLoaderReflectionToolkit.java#L42)
which leads to a

`java.lang.LinkageError loader (instance of  hudson/ClassicPluginStrategy$AntClassLoader2): attempted  duplicate class definition for name: "hudson/plugins/analysis/core/AbstractProjectAction"`

which, in turned is completely swallowed [here](https://github.com/jenkinsci/jenkins/blob/b2c69b4a355b47f6da400a21173680daea4f6a4c/core/src/main/java/hudson/ClassicPluginStrategy.java#L575)
because it is hidden behind an `InvocationTargetException` and the code assumes that all the ITEs are caused due to `ClassNotFoundError` errors.

The `ExposeClassLoaderBug` program, when run, produces the following output for me (I also created a copy of ClassicPluginStrategy with some additional debugging
when the ITE's root cause is not a CNFE)

```
/Library/Java/JavaVirtualMachines/jdk1.7.0_25.jdk/Contents/Home/bin/java -Didea.launcher.port=7538 "-Didea.launcher.bin.path=/Applications/IntelliJ IDEA 12 CE.app/bin" -Dfile.encoding=UTF-8 -classpath "/Library/Java/JavaVirtualMachines/jdk1.7.0_25.jdk/Contents/Home/lib/ant-javafx.jar:/Library/Java/JavaVirtualMachines/jdk1.7.0_25.jdk/Contents/Home/lib/dt.jar:/Library/Java/JavaVirtualMachines/jdk1.7.0_25.jdk/Contents/Home/lib/javafx-doclet.jar:/Library/Java/JavaVirtualMachines/jdk1.7.0_25.jdk/Contents/Home/lib/javafx-mx.jar:/Library/Java/JavaVirtualMachines/jdk1.7.0_25.jdk/Contents/Home/lib/jconsole.jar:/Library/Java/JavaVirtualMachines/jdk1.7.0_25.jdk/Contents/Home/lib/sa-jdi.jar:/Library/Java/JavaVirtualMachines/jdk1.7.0_25.jdk/Contents/Home/lib/tools.jar:/Library/Java/JavaVirtualMachines/jdk1.7.0_25.jdk/Contents/Home/jre/lib/charsets.jar:/Library/Java/JavaVirtualMachines/jdk1.7.0_25.jdk/Contents/Home/jre/lib/deploy.jar:/Library/Java/JavaVirtualMachines/jdk1.7.0_25.jdk/Contents/Home/jre/lib/htmlconverter.jar:/Library/Java/JavaVirtualMachines/jdk1.7.0_25.jdk/Contents/Home/jre/lib/javaws.jar:/Library/Java/JavaVirtualMachines/jdk1.7.0_25.jdk/Contents/Home/jre/lib/jce.jar:/Library/Java/JavaVirtualMachines/jdk1.7.0_25.jdk/Contents/Home/jre/lib/jfr.jar:/Library/Java/JavaVirtualMachines/jdk1.7.0_25.jdk/Contents/Home/jre/lib/jfxrt.jar:/Library/Java/JavaVirtualMachines/jdk1.7.0_25.jdk/Contents/Home/jre/lib/JObjC.jar:/Library/Java/JavaVirtualMachines/jdk1.7.0_25.jdk/Contents/Home/jre/lib/jsse.jar:/Library/Java/JavaVirtualMachines/jdk1.7.0_25.jdk/Contents/Home/jre/lib/management-agent.jar:/Library/Java/JavaVirtualMachines/jdk1.7.0_25.jdk/Contents/Home/jre/lib/plugin.jar:/Library/Java/JavaVirtualMachines/jdk1.7.0_25.jdk/Contents/Home/jre/lib/resources.jar:/Library/Java/JavaVirtualMachines/jdk1.7.0_25.jdk/Contents/Home/jre/lib/rt.jar:/Library/Java/JavaVirtualMachines/jdk1.7.0_25.jdk/Contents/Home/jre/lib/ext/dnsns.jar:/Library/Java/JavaVirtualMachines/jdk1.7.0_25.jdk/Contents/Home/jre/lib/ext/localedata.jar:/Library/Java/JavaVirtualMachines/jdk1.7.0_25.jdk/Contents/Home/jre/lib/ext/sunec.jar:/Library/Java/JavaVirtualMachines/jdk1.7.0_25.jdk/Contents/Home/jre/lib/ext/sunjce_provider.jar:/Library/Java/JavaVirtualMachines/jdk1.7.0_25.jdk/Contents/Home/jre/lib/ext/sunpkcs11.jar:/Library/Java/JavaVirtualMachines/jdk1.7.0_25.jdk/Contents/Home/jre/lib/ext/zipfs.jar:/Users/user/jenkinsci/jenkins-classloader/target/classes:/Users/user/.m2/repository/org/jenkins-ci/main/jenkins-core/1.532/jenkins-core-1.532.jar:/Users/user/.m2/repository/org/jenkins-ci/main/remoting/2.32/remoting-2.32.jar:/Users/user/.m2/repository/org/apache/ant/ant/1.8.3/ant-1.8.3.jar:/Users/user/.m2/repository/org/apache/ant/ant-launcher/1.8.3/ant-launcher-1.8.3.jar:/Users/user/.m2/repository/org/jenkins-ci/constant-pool-scanner/1.2/constant-pool-scanner-1.2.jar:/Users/user/.m2/repository/org/jenkins-ci/main/cli/1.532/cli-1.532.jar:/Users/user/.m2/repository/commons-codec/commons-codec/1.8/commons-codec-1.8.jar:/Users/user/.m2/repository/org/jvnet/localizer/localizer/1.10/localizer-1.10.jar:/Users/user/.m2/repository/org/jenkins-ci/trilead-ssh2/build214-jenkins-3/trilead-ssh2-build214-jenkins-3.jar:/Users/user/.m2/repository/org/jenkins-ci/version-number/1.1/version-number-1.1.jar:/Users/user/.m2/repository/org/jenkins-ci/crypto-util/1.1/crypto-util-1.1.jar:/Users/user/.m2/repository/commons-io/commons-io/1.4/commons-io-1.4.jar:/Users/user/.m2/repository/org/jvnet/hudson/jtidy/4aug2000r7-dev-hudson-1/jtidy-4aug2000r7-dev-hudson-1.jar:/Users/user/.m2/repository/com/google/inject/guice/4.0-beta/guice-4.0-beta-no_aop.jar:/Users/user/.m2/repository/javax/inject/javax.inject/1/javax.inject-1.jar:/Users/user/.m2/repository/aopalliance/aopalliance/1.0/aopalliance-1.0.jar:/Users/user/.m2/repository/com/google/guava/guava/11.0.1/guava-11.0.1.jar:/Users/user/.m2/repository/com/google/code/findbugs/jsr305/1.3.9/jsr305-1.3.9.jar:/Users/user/.m2/repository/org/jruby/ext/posix/jna-posix/1.0.3/jna-posix-1.0.3.jar:/Users/user/.m2/repository/com/github/jnr/jnr-posix/3.0.0/jnr-posix-3.0.0.jar:/Users/user/.m2/repository/com/github/jnr/jnr-ffi/1.0.4/jnr-ffi-1.0.4.jar:/Users/user/.m2/repository/com/github/jnr/jffi/1.2.7/jffi-1.2.7.jar:/Users/user/.m2/repository/com/github/jnr/jffi/1.2.7/jffi-1.2.7-native.jar:/Users/user/.m2/repository/org/ow2/asm/asm/4.0/asm-4.0.jar:/Users/user/.m2/repository/org/ow2/asm/asm-commons/4.0/asm-commons-4.0.jar:/Users/user/.m2/repository/org/ow2/asm/asm-tree/4.0/asm-tree-4.0.jar:/Users/user/.m2/repository/org/ow2/asm/asm-analysis/4.0/asm-analysis-4.0.jar:/Users/user/.m2/repository/org/ow2/asm/asm-util/4.0/asm-util-4.0.jar:/Users/user/.m2/repository/com/github/jnr/jnr-x86asm/1.0.2/jnr-x86asm-1.0.2.jar:/Users/user/.m2/repository/com/github/jnr/jnr-constants/0.8.4/jnr-constants-0.8.4.jar:/Users/user/.m2/repository/org/kohsuke/trilead-putty-extension/1.2/trilead-putty-extension-1.2.jar:/Users/user/.m2/repository/org/kohsuke/stapler/stapler-groovy/1.218/stapler-groovy-1.218.jar:/Users/user/.m2/repository/org/kohsuke/stapler/stapler-jelly/1.218/stapler-jelly-1.218.jar:/Users/user/.m2/repository/org/kohsuke/stapler/stapler/1.218/stapler-1.218.jar:/Users/user/.m2/repository/commons-discovery/commons-discovery/0.4/commons-discovery-0.4.jar:/Users/user/.m2/repository/commons-logging/commons-logging/1.1.3/commons-logging-1.1.3.jar:/Users/user/.m2/repository/commons-beanutils/commons-beanutils/1.8.3/commons-beanutils-1.8.3.jar:/Users/user/.m2/repository/org/kohsuke/stapler/json-lib/2.4-jenkins-2/json-lib-2.4-jenkins-2.jar:/Users/user/.m2/repository/commons-collections/commons-collections/3.2.1/commons-collections-3.2.1.jar:/Users/user/.m2/repository/commons-lang/commons-lang/2.6/commons-lang-2.6.jar:/Users/user/.m2/repository/net/sf/ezmorph/ezmorph/1.0.6/ezmorph-1.0.6.jar:/Users/user/.m2/repository/org/jvnet/tiger-types/1.3/tiger-types-1.3.jar:/Users/user/.m2/repository/org/kohsuke/asm3/3.3.0/asm3-3.3.0.jar:/Users/user/.m2/repository/commons-fileupload/commons-fileupload/1.2.1/commons-fileupload-1.2.1.jar:/Users/user/.m2/repository/com/jcraft/jzlib/1.1.2/jzlib-1.1.2.jar:/Users/user/.m2/repository/org/jenkins-ci/commons-jelly/1.1-jenkins-20120928/commons-jelly-1.1-jenkins-20120928.jar:/Users/user/.m2/repository/org/jenkins-ci/commons-jexl/1.1-jenkins-20111212/commons-jexl-1.1-jenkins-20111212.jar:/Users/user/.m2/repository/org/jvnet/hudson/dom4j/dom4j/1.6.1-hudson-3/dom4j-1.6.1-hudson-3.jar:/Users/user/.m2/repository/org/codehaus/groovy/groovy-all/1.8.9/groovy-all-1.8.9.jar:/Users/user/.m2/repository/org/kohsuke/stapler/stapler-jrebel/1.218/stapler-jrebel-1.218.jar:/Users/user/.m2/repository/org/kohsuke/windows-package-checker/1.0/windows-package-checker-1.0.jar:/Users/user/.m2/repository/org/kohsuke/stapler/stapler-adjunct-zeroclipboard/1.1.7-1/stapler-adjunct-zeroclipboard-1.1.7-1.jar:/Users/user/.m2/repository/org/kohsuke/stapler/stapler-adjunct-timeline/1.4/stapler-adjunct-timeline-1.4.jar:/Users/user/.m2/repository/org/kohsuke/stapler/stapler-adjunct-codemirror/1.2/stapler-adjunct-codemirror-1.2.jar:/Users/user/.m2/repository/com/infradna/tool/bridge-method-annotation/1.8/bridge-method-annotation-1.8.jar:/Users/user/.m2/repository/org/jenkins-ci/annotation-indexer/1.4/annotation-indexer-1.4.jar:/Users/user/.m2/repository/commons-httpclient/commons-httpclient/3.1/commons-httpclient-3.1.jar:/Users/user/.m2/repository/args4j/args4j/2.0.23/args4j-2.0.23.jar:/Users/user/.m2/repository/org/jenkins-ci/bytecode-compatibility-transformer/1.3/bytecode-compatibility-transformer-1.3.jar:/Users/user/.m2/repository/org/jvnet/hudson/task-reactor/1.2/task-reactor-1.2.jar:/Users/user/.m2/repository/antlr/antlr/2.7.6/antlr-2.7.6.jar:/Users/user/.m2/repository/org/jvnet/hudson/xstream/1.4.4-jenkins-4/xstream-1.4.4-jenkins-4.jar:/Users/user/.m2/repository/xmlpull/xmlpull/1.1.3.1/xmlpull-1.1.3.1.jar:/Users/user/.m2/repository/xpp3/xpp3_min/1.1.4c/xpp3_min-1.1.4c.jar:/Users/user/.m2/repository/jfree/jfreechart/1.0.9/jfreechart-1.0.9.jar:/Users/user/.m2/repository/jfree/jcommon/1.0.12/jcommon-1.0.12.jar:/Users/user/.m2/repository/commons-digester/commons-digester/2.1/commons-digester-2.1.jar:/Users/user/.m2/repository/javax/mail/mail/1.4.4/mail-1.4.4.jar:/Users/user/.m2/repository/org/jvnet/hudson/activation/1.1.1-hudson-1/activation-1.1.1-hudson-1.jar:/Users/user/.m2/repository/jaxen/jaxen/1.1-beta-11/jaxen-1.1-beta-11.jar:/Users/user/.m2/repository/commons-jelly/commons-jelly-tags-fmt/1.0/commons-jelly-tags-fmt-1.0.jar:/Users/user/.m2/repository/commons-jelly/commons-jelly-tags-xml/1.1/commons-jelly-tags-xml-1.1.jar:/Users/user/.m2/repository/org/jvnet/hudson/commons-jelly-tags-define/1.0.1-hudson-20071021/commons-jelly-tags-define-1.0.1-hudson-20071021.jar:/Users/user/.m2/repository/org/acegisecurity/acegi-security/1.0.7/acegi-security-1.0.7.jar:/Users/user/.m2/repository/org/springframework/spring-core/2.5.6.SEC03/spring-core-2.5.6.SEC03.jar:/Users/user/.m2/repository/org/springframework/spring-jdbc/1.2.9/spring-jdbc-1.2.9.jar:/Users/user/.m2/repository/org/springframework/spring-beans/2.5.6.SEC03/spring-beans-2.5.6.SEC03.jar:/Users/user/.m2/repository/org/springframework/spring-dao/1.2.9/spring-dao-1.2.9.jar:/Users/user/.m2/repository/org/springframework/spring-context/2.5.6.SEC03/spring-context-2.5.6.SEC03.jar:/Users/user/.m2/repository/oro/oro/2.0.8/oro-2.0.8.jar:/Users/user/.m2/repository/log4j/log4j/1.2.9/log4j-1.2.9.jar:/Users/user/.m2/repository/jline/jline/0.9.94/jline-0.9.94.jar:/Users/user/.m2/repository/junit/junit/3.8.1/junit-3.8.1.jar:/Users/user/.m2/repository/org/fusesource/jansi/jansi/1.9/jansi-1.9.jar:/Users/user/.m2/repository/org/springframework/spring-webmvc/2.5.6.SEC03/spring-webmvc-2.5.6.SEC03.jar:/Users/user/.m2/repository/org/springframework/spring-context-support/2.5.6.SEC03/spring-context-support-2.5.6.SEC03.jar:/Users/user/.m2/repository/org/springframework/spring-web/2.5.6.SEC03/spring-web-2.5.6.SEC03.jar:/Users/user/.m2/repository/org/springframework/spring-aop/2.5.6.SEC03/spring-aop-2.5.6.SEC03.jar:/Users/user/.m2/repository/xpp3/xpp3/1.1.4c/xpp3-1.1.4c.jar:/Users/user/.m2/repository/javax/servlet/jstl/1.1.0/jstl-1.1.0.jar:/Users/user/.m2/repository/com/sun/xml/txw2/txw2/20110809/txw2-20110809.jar:/Users/user/.m2/repository/javax/xml/stream/stax-api/1.0-2/stax-api-1.0-2.jar:/Users/user/.m2/repository/relaxngDatatype/relaxngDatatype/20020414/relaxngDatatype-20020414.jar:/Users/user/.m2/repository/org/jvnet/winp/winp/1.16/winp-1.16.jar:/Users/user/.m2/repository/org/jenkins-ci/memory-monitor/1.7/memory-monitor-1.7.jar:/Users/user/.m2/repository/net/java/dev/jna/jna/3.3.0-jenkins-3/jna-3.3.0-jenkins-3.jar:/Users/user/.m2/repository/org/codehaus/woodstox/wstx-asl/3.2.9/wstx-asl-3.2.9.jar:/Users/user/.m2/repository/stax/stax-api/1.0.1/stax-api-1.0.1.jar:/Users/user/.m2/repository/org/jenkins-ci/jmdns/3.4.0-jenkins-3/jmdns-3.4.0-jenkins-3.jar:/Users/user/.m2/repository/org/kohsuke/akuma/1.9/akuma-1.9.jar:/Users/user/.m2/repository/org/kohsuke/libpam4j/1.6/libpam4j-1.6.jar:/Users/user/.m2/repository/org/jvnet/libzfs/libzfs/0.5/libzfs-0.5.jar:/Users/user/.m2/repository/com/sun/solaris/embedded_su4j/1.1/embedded_su4j-1.1.jar:/Users/user/.m2/repository/net/java/sezpoz/sezpoz/1.9/sezpoz-1.9.jar:/Users/user/.m2/repository/org/jenkins-ci/jinterop-wmi/1.1/jinterop-wmi-1.1.jar:/Users/user/.m2/repository/org/kohsuke/jinterop/jinterop-proxy/1.1/jinterop-proxy-1.1.jar:/Users/user/.m2/repository/org/kohsuke/jinterop/j-interop/2.0.6-kohsuke-1/j-interop-2.0.6-kohsuke-1.jar:/Users/user/.m2/repository/org/kohsuke/jinterop/j-interopdeps/2.0.6-kohsuke-1/j-interopdeps-2.0.6-kohsuke-1.jar:/Users/user/.m2/repository/org/samba/jcifs/jcifs/1.3.14-kohsuke-1/jcifs-1.3.14-kohsuke-1.jar:/Users/user/.m2/repository/org/jenkins-ci/windows-remote-command/1.3/windows-remote-command-1.3.jar:/Users/user/.m2/repository/org/jvnet/robust-http-client/robust-http-client/1.2/robust-http-client-1.2.jar:/Users/user/.m2/repository/org/kohsuke/access-modifier-annotation/1.4/access-modifier-annotation-1.4.jar:/Users/user/.m2/repository/org/kohsuke/owasp-html-sanitizer/r88/owasp-html-sanitizer-r88.jar:/Users/user/.m2/repository/org/mindrot/jbcrypt/0.3m/jbcrypt-0.3m.jar:/Users/user/.m2/repository/javax/servlet/javax.servlet-api/3.0.1/javax.servlet-api-3.0.1.jar:/Applications/IntelliJ IDEA 12 CE.app/lib/idea_rt.jar" com.intellij.rt.execution.application.AppMain ExposeClassLoaderBug
ITE for AntClassLoader[/Users/user/jenkinsci/jenkins-classloader/./testData/analysis-core/WEB-INF/lib/annotations-2.0.0.jar:/Users/user/jenkinsci/jenkins-classloader/./testData/analysis-core/WEB-INF/lib/asm-3.3.1.jar:/Users/user/jenkinsci/jenkins-classloader/./testData/analysis-core/WEB-INF/lib/cglib-2.2.2.jar:/Users/user/jenkinsci/jenkins-classloader/./testData/analysis-core/WEB-INF/lib/classes.jar:/Users/user/jenkinsci/jenkins-classloader/./testData/analysis-core/WEB-INF/lib/commons-beanutils-1.8.3.jar:/Users/user/jenkinsci/jenkins-classloader/./testData/analysis-core/WEB-INF/lib/commons-digester3-3.2.jar:/Users/user/jenkinsci/jenkins-classloader/./testData/analysis-core/WEB-INF/lib/commons-logging-1.1.1.jar:/Users/user/jenkinsci/jenkins-classloader/./testData/analysis-core/WEB-INF/lib/java2html-5.0.jar:/Users/user/jenkinsci/jenkins-classloader/./testData/analysis-core/WEB-INF/lib/jsr305-2.0.0.jar:/Users/user/jenkinsci/jenkins-classloader/./testData/analysis-core/WEB-INF/lib/xercesImpl-2.11.0.jar:/Users/user/jenkinsci/jenkins-classloader/./testData/analysis-core/WEB-INF/lib/xml-apis-1.4.01.jar] in Thread-1
loader (instance of  hudson/ClassicPluginStrategy$AntClassLoader2): attempted  duplicate class definition for name: "hudson/plugins/analysis/core/AbstractProjectAction"
java.lang.reflect.InvocationTargetException
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:606)
	at jenkins.ClassLoaderReflectionToolkit.findClass(ClassLoaderReflectionToolkit.java:44)
	at hudson.ClassicPluginStrategy$DependencyClassLoader.findClass(ClassicPluginStrategy.java:553)
	at java.lang.ClassLoader.loadClass(ClassLoader.java:424)
	at java.lang.ClassLoader.loadClass(ClassLoader.java:357)
	at org.apache.tools.ant.AntClassLoader.findBaseClass(AntClassLoader.java:1387)
	at org.apache.tools.ant.AntClassLoader.loadClass(AntClassLoader.java:1064)
	at java.lang.ClassLoader.loadClass(ClassLoader.java:357)
	at java.lang.ClassLoader.defineClass1(Native Method)
	at java.lang.ClassLoader.defineClass(ClassLoader.java:792)
	at org.apache.tools.ant.AntClassLoader.defineClassFromData(AntClassLoader.java:1128)
	at hudson.ClassicPluginStrategy$AntClassLoader2.defineClassFromData(ClassicPluginStrategy.java:690)
	at org.apache.tools.ant.AntClassLoader.getClassFromStream(AntClassLoader.java:1299)
	at org.apache.tools.ant.AntClassLoader.findClassInComponents(AntClassLoader.java:1355)
	at org.apache.tools.ant.AntClassLoader.findClass(AntClassLoader.java:1315)
	at org.apache.tools.ant.AntClassLoader.loadClass(AntClassLoader.java:1068)
	at java.lang.ClassLoader.loadClass(ClassLoader.java:357)
	at ExposeClassLoaderBug$3.run(ExposeClassLoaderBug.java:48)
	at java.lang.Thread.run(Thread.java:724)
Caused by: java.lang.LinkageError: loader (instance of  hudson/ClassicPluginStrategy$AntClassLoader2): attempted  duplicate class definition for name: "hudson/plugins/analysis/core/AbstractProjectAction"
	at java.lang.ClassLoader.defineClass1(Native Method)
	at java.lang.ClassLoader.defineClass(ClassLoader.java:792)
	at org.apache.tools.ant.AntClassLoader.defineClassFromData(AntClassLoader.java:1128)
	at hudson.ClassicPluginStrategy$AntClassLoader2.defineClassFromData(ClassicPluginStrategy.java:690)
	at org.apache.tools.ant.AntClassLoader.getClassFromStream(AntClassLoader.java:1299)
	at org.apache.tools.ant.AntClassLoader.findClassInComponents(AntClassLoader.java:1355)
	at org.apache.tools.ant.AntClassLoader.findClass(AntClassLoader.java:1315)
	... 22 more
ITE for AntClassLoader[/Users/user/jenkinsci/jenkins-classloader/./testData/analysis-core/WEB-INF/lib/annotations-2.0.0.jar:/Users/user/jenkinsci/jenkins-classloader/./testData/analysis-core/WEB-INF/lib/asm-3.3.1.jar:/Users/user/jenkinsci/jenkins-classloader/./testData/analysis-core/WEB-INF/lib/cglib-2.2.2.jar:/Users/user/jenkinsci/jenkins-classloader/./testData/analysis-core/WEB-INF/lib/classes.jar:/Users/user/jenkinsci/jenkins-classloader/./testData/analysis-core/WEB-INF/lib/commons-beanutils-1.8.3.jar:/Users/user/jenkinsci/jenkins-classloader/./testData/analysis-core/WEB-INF/lib/commons-digester3-3.2.jar:/Users/user/jenkinsci/jenkins-classloader/./testData/analysis-core/WEB-INF/lib/commons-logging-1.1.1.jar:/Users/user/jenkinsci/jenkins-classloader/./testData/analysis-core/WEB-INF/lib/java2html-5.0.jar:/Users/user/jenkinsci/jenkins-classloader/./testData/analysis-core/WEB-INF/lib/jsr305-2.0.0.jar:/Users/user/jenkinsci/jenkins-classloader/./testData/analysis-core/WEB-INF/lib/xercesImpl-2.11.0.jar:/Users/user/jenkinsci/jenkins-classloader/./testData/analysis-core/WEB-INF/lib/xml-apis-1.4.01.jar] in Thread-2
loader (instance of  hudson/ClassicPluginStrategy$AntClassLoader2): attempted  duplicate class definition for name: "hudson/plugins/analysis/core/AbstractProjectAction"
java.lang.reflect.InvocationTargetException
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:606)
	at jenkins.ClassLoaderReflectionToolkit.findClass(ClassLoaderReflectionToolkit.java:44)
	at hudson.ClassicPluginStrategy$DependencyClassLoader.findClass(ClassicPluginStrategy.java:553)
	at java.lang.ClassLoader.loadClass(ClassLoader.java:424)
	at java.lang.ClassLoader.loadClass(ClassLoader.java:357)
	at org.apache.tools.ant.AntClassLoader.findBaseClass(AntClassLoader.java:1387)
	at org.apache.tools.ant.AntClassLoader.loadClass(AntClassLoader.java:1064)
	at java.lang.ClassLoader.loadClass(ClassLoader.java:357)
	at java.lang.ClassLoader.defineClass1(Native Method)
	at java.lang.ClassLoader.defineClass(ClassLoader.java:792)
	at org.apache.tools.ant.AntClassLoader.defineClassFromData(AntClassLoader.java:1128)
	at hudson.ClassicPluginStrategy$AntClassLoader2.defineClassFromData(ClassicPluginStrategy.java:690)
	at org.apache.tools.ant.AntClassLoader.getClassFromStream(AntClassLoader.java:1299)
	at org.apache.tools.ant.AntClassLoader.findClassInComponents(AntClassLoader.java:1355)
	at org.apache.tools.ant.AntClassLoader.findClass(AntClassLoader.java:1315)
	at org.apache.tools.ant.AntClassLoader.loadClass(AntClassLoader.java:1068)
	at java.lang.ClassLoader.loadClass(ClassLoader.java:357)
	at ExposeClassLoaderBug$3.run(ExposeClassLoaderBug.java:51)
	at java.lang.Thread.run(Thread.java:724)
Caused by: java.lang.LinkageError: loader (instance of  hudson/ClassicPluginStrategy$AntClassLoader2): attempted  duplicate class definition for name: "hudson/plugins/analysis/core/AbstractProjectAction"
	at java.lang.ClassLoader.defineClass1(Native Method)
	at java.lang.ClassLoader.defineClass(ClassLoader.java:792)
	at org.apache.tools.ant.AntClassLoader.defineClassFromData(AntClassLoader.java:1128)
	at hudson.ClassicPluginStrategy$AntClassLoader2.defineClassFromData(ClassicPluginStrategy.java:690)
	at org.apache.tools.ant.AntClassLoader.getClassFromStream(AntClassLoader.java:1299)
	at org.apache.tools.ant.AntClassLoader.findClassInComponents(AntClassLoader.java:1355)
	at org.apache.tools.ant.AntClassLoader.findClass(AntClassLoader.java:1315)
	... 22 more
FAIL at thread:Thread-1 loading android-lint
hudson/plugins/analysis/core/AbstractProjectAction
FAIL at thread:Thread-2 loading findbugs
hudson/plugins/analysis/core/AbstractProjectAction

Process finished with exit code 0
```

This is easily fixed for correctness by synchronizing the `findClass` method in `ClassLoaderReflectionToolkit`
 but performance-wise you might want to do something else.

